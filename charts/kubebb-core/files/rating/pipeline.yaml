apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: component-rbac-gen
  annotations:
    tekton.dev/tags: component-rbac-gen
    tekton.dev/displayName: "component-rbac-gen"
    tekton.dev/platforms: "linux/amd64"
  namespace: default
spec:
  description: >-
    convert image to base64
  params:
    - name: COMPONENT_NAME
      description: >-
        component name
    - name: REPOSITORY_NAME
      description: repository name
      default: "kubebb"
    - name: VERSION
      description: component version
    - name: URL
      description: the full URL of the component tgz file.
  results:
  - name: HELM_LINT
    value: $(tasks.helm-lint.results.LINT)
  - name: RBACCM
    value: $(tasks.rback.results.RBACCM)
  tasks:
    - name: rback
      retries: 2
      taskRef:
        name: rback
      runAfter:
      - helm-lint
      params:
        - name: url
          value: $(params.URL)
        - name: component
          value: $(params.COMPONENT_NAME)
        - name: version
          value: $(params.VERSION)
        - name: repository
          value: $(params.REPOSITORY_NAME)
    - name: helm-lint
      retries: 2
      taskRef:
        name: helm-lint
      params:
        - name: url
          value: $(params.URL)
        - name: component
          value: $(params.COMPONENT_NAME)
        - name: version
          value: $(params.VERSION)
